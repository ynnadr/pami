<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAMI Thursday Walk - Karet Bivak</title>

    <!-- Memuat library Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

    <!-- Memuat library Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <style>
        /* Desain Mobile-First */
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 0;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
        }

        #header {
            background-color: #f8f8f8;
            padding: 15px 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 1000;
            flex-shrink: 0;
        }

        #header h1 {
            margin: 0 0 5px 0;
            font-size: 1.4em;
            color: #2c3e50;
        }

        #header p {
            margin: 0 0 3px 0;
            font-size: 0.9em;
            color: #7f8c8d;
        }

        #totalRouteLength {
            font-weight: bold;
            color: #e67e22;
        }

        #map {
            flex-grow: 1;
            width: 100vw;
            z-index: 1;
            background-color: #e0e0e0; /* Warna latar belakang saat peta dimuat */
        }

        /* Style untuk popup agar lebih rapi */
        .leaflet-popup-content-wrapper {
            border-radius: 5px;
        }
        .leaflet-popup-content p {
            margin: 0.5em 0;
        }
        .popup-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        /* Style untuk tooltip agar jelas */
        .leaflet-tooltip {
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            border-radius: 3px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            font-weight: bold;
            padding: 6px 10px;
        }

        /* Untuk layar yang lebih besar (desktop), sesuaikan ukuran font */
        @media (min-width: 768px) {
            #header h1 {
                font-size: 1.8em;
            }
            #header p {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>

    <!-- Header Informasi PAMI Walk -->
    <div id="header">
        <h1>PAMI Thursday Walk</h1>
        <p>11 September 2025 - Start at 7:30am</p>
        <p>Total route (est): <span id="totalRouteLength">Menghitung...</span> km.</p>
    </div>

    <!-- Elemen div ini adalah tempat peta akan ditampilkan -->
    <div id="map"></div>

    <script>
        // 1. Data GeoJSON Anda
        const geojsonData = {"type":"FeatureCollection","features":[{"type":"Feature","properties":{"name":"Pintu belakang TPU Karet Bivak","marker-color":"#ff0000","marker-size":"medium","marker-symbol":"circle"},"geometry":{"coordinates":[106.81368714559835,-6.204650739325302],"type":"Point"},"id":0},{"type":"Feature","properties":{"name":"Rute 3","stroke":"#808000","stroke-width":5,"stroke-opacity":1},"geometry":{"coordinates":[[106.81598904460952,-6.2008666712409735],[106.81516077125542,-6.2006696427777825],[106.81518941899208,-6.201403005801808],[106.81530759089765,-6.201449285958475],[106.81540427700298,-6.201531166225394],[106.81546515344081,-6.201641526564842],[106.8159999287488,-6.20335621405772],[106.81577311616627,-6.203378809043841],[106.81556183911994,-6.203375249044527]],"type":"LineString"},"id":1},{"type":"Feature","properties":{"name":"Gerbang TPU Karet Bivak","marker-color":"#ff0000","marker-size":"medium","marker-symbol":"circle"},"geometry":{"coordinates":[106.81566926812627,-6.203325409058181],"type":"Point"},"id":2},{"type":"Feature","properties":{"name":"FINISH: Stasiun Karet"},"geometry":{"coordinates":[106.81602600650046,-6.200878073208969],"type":"Point"},"id":3},{"type":"Feature","properties":{"name":"Rute 2","stroke":"#b88e65","stroke-width":5,"stroke-opacity":1},"geometry":{"coordinates":[[106.81370225769962,-6.204638741128861],[106.81380503727996,-6.205341875333843],[106.81363079247507,-6.205367172583422],[106.81373838362902,-6.2064537812743055],[106.81215658425685,-6.206538435857809],[106.81215071212887,-6.206786918669366],[106.81199934616888,-6.206782480366073],[106.81185254041998,-6.2068012891285775],[106.81171922167329,-6.206833168414732],[106.81159012373365,-6.206861816296694],[106.811455201206,-6.206935032631023],[106.81159792975836,-6.207180043760445],[106.81188884562101,-6.20755559114842],[106.81200064696588,-6.207673876729913],[106.81205481220138,-6.207826260749016],[106.8120901059836,-6.207919562440395],[106.81212175987582,-6.208186107094434],[106.81265898375375,-6.208740734250057],[106.81238373494466,-6.208797716183881],[106.81203969134435,-6.208974211946014],[106.81185456108796,-6.208704845099859]],"type":"LineString"},"id":4},{"type":"Feature","properties":{"name":"Rute 1","stroke":"#ffd700","stroke-width":5,"stroke-opacity":1},"geometry":{"coordinates":[[106.81184652605026,-6.208722481690174],[106.81190310782779,-6.2087875285424445],[106.81202929258723,-6.208984001465808],[106.81209675930529,-6.209147848517176],[106.81226710837473,-6.20968116352465],[106.81230240045431,-6.209877031276875],[106.81233287503602,-6.2101258439371065],[106.81233150432729,-6.210570203661192],[106.81226412728597,-6.2115465772018865],[106.81224536598012,-6.211920514814395],[106.81112426507502,-6.212038728593569],[106.81120759190486,-6.213286365157089],[106.81125216070728,-6.213486211712322],[106.81162868236248,-6.214192928190741],[106.81180020802412,-6.214465519869847],[106.81201377752058,-6.214925103653812],[106.8121698122859,-6.215214474008292],[106.81215959669049,-6.215244460140781],[106.81213854906713,-6.215271656365076],[106.81210691069901,-6.2152995721782816],[106.81225424908752,-6.215982262432632],[106.81333787066666,-6.2158348636481975],[106.81358144496647,-6.216337974771932],[106.81360479799787,-6.2163681210133035],[106.81365831445373,-6.216408422779693],[106.81367004908327,-6.21642037289773],[106.81340877438674,-6.216633534086171]],"type":"LineString"},"id":5},{"type":"Feature","properties":{"name":"START: Taman Sentra BRI","marker-color":"#ff0000","marker-size":"medium","marker-symbol":"circle"},"geometry":{"coordinates":[106.81353811998463,-6.216808633165073],"type":"Point"},"id":6},{"type":"Feature","properties":{"name":"Jakarta Notebook","marker-color":"#ff0000","marker-size":"medium","marker-symbol":"circle"},"geometry":{"coordinates":[106.81176497093998,-6.208786456096718],"type":"Point"},"id":7},{"type":"Feature","properties":{},"geometry":{"coordinates":[[[106.81555277317233,-6.203331139405321],[106.81557767507763,-6.203331139405321],[106.81557767507763,-6.202891155115495],[106.81555277317233,-6.202891155115495],[106.81555277317233,-6.203331139405321]]],"type":"Polygon"}},{"type":"Feature","properties":{"name":"TPU Karet Bivak","stroke":"#555555","stroke-width":2,"stroke-opacity":1,"fill":"#555555","fill-opacity":0.5,"note":"TPU Karet Bivak merupakan tempat peristirahatan akhir bagi banyak tokoh bangsa dari berbagai bidang, seperti agama, seni, budaya, hukum, dan politik. Memiliki luas 16, 2 hektare, yang merupakan area pemakaman terbesar kedua di Jakarta."},"geometry":{"coordinates":[[[106.8154905090048,-6.203305292143924],[106.81550079169722,-6.202681720213917],[106.81533626861682,-6.201996812490492],[106.81523344169108,-6.201731027163589],[106.81509976668798,-6.201639024520148],[106.81490439553016,-6.20156746689608],[106.81385556089305,-6.201444796663253],[106.8134545358838,-6.201455019183712],[106.81156252045969,-6.201649247036855],[106.81145969353395,-6.2020479250374905],[106.81153167238102,-6.202201262650149],[106.81174760892497,-6.20230348770076],[106.81192241469785,-6.202395490229648],[106.81200467623745,-6.202773722676724],[106.81189156662055,-6.203366627048794],[106.81191213200543,-6.203530186758087],[106.8119841108525,-6.203683523939489],[106.81199439354492,-6.203816416126216],[106.81204580700847,-6.203949308280755],[106.81223089547376,-6.204082200401714],[106.81248796278618,-6.204235537422647],[106.81297124933502,-6.204358207007417],[106.81349566665489,-6.204409319325464],[106.81412291089794,-6.204419541788468],[106.81477072052718,-6.204358207007417],[106.81569616285498,-6.204317317149375],[106.8154905090048,-6.203305292143924]]],"type":"Polygon"},"id":9}]};

        // 2. Inisialisasi Peta
        const map = L.map('map');

        // 3. Tambahkan Tile Layer (Gambar Peta Dasar)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // --- Fungsi untuk menghitung panjang rute (Haversine Formula) ---
        function toRadians(deg) {
            return deg * Math.PI / 180;
        }

        function haversineDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius Bumi dalam km
            const dLat = toRadians(lat2 - lat1);
            const dLon = toRadians(lon2 - lon1);
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; // Jarak dalam km
        }

        function calculateLineStringLength(coordinates) {
            let totalLength = 0;
            for (let i = 0; i < coordinates.length - 1; i++) {
                const [lon1, lat1] = coordinates[i];
                const [lon2, lat2] = coordinates[i + 1];
                totalLength += haversineDistance(lat1, lon1, lat2, lon2);
            }
            return totalLength;
        }

        // --- Hitung total panjang rute dan perbarui header ---
        let totalEstimatedRouteLength = 0;
        geojsonData.features.forEach(feature => {
            if (feature.geometry.type === 'LineString' && feature.properties.name && feature.properties.name.startsWith('Rute')) {
                totalEstimatedRouteLength += calculateLineStringLength(feature.geometry.coordinates);
            }
        });
        document.getElementById('totalRouteLength').textContent = totalEstimatedRouteLength.toFixed(2);
        
        // 4. Tambahkan GeoJSON Layer ke Peta
        const geoJsonLayer = L.geoJSON(geojsonData, {
            // Fungsi untuk styling garis dan poligon
            style: function (feature) {
                return {
                    color: feature.properties.stroke || '#3388ff',
                    weight: feature.properties['stroke-width'] || 3,
                    opacity: feature.properties['stroke-opacity'] || 1.0,
                    fillColor: feature.properties.fill || '#3388ff',
                    fillOpacity: feature.properties['fill-opacity'] || 0.2
                };
            },
            
            // Fungsi yang dijalankan untuk setiap fitur (objek)
            onEachFeature: function (feature, layer) {
                const props = feature.properties;
                // --- Logika untuk Popup (saat diklik) ---
                if (props) {
                    let popupContent = '';
                    if (props.name) popupContent += `<div class="popup-title">${props.name}</div>`;
                    if (props.note) popupContent += `<p>${props.note}</p>`;
                    if (popupContent) layer.bindPopup(popupContent);
                }

                // --- Logika untuk Tooltip (saat hover/sentuh) ---
                if (props && props.name) {
                    if (feature.geometry.type === 'LineString') {
                        const length = calculateLineStringLength(feature.geometry.coordinates);
                        const tooltipContent = `${props.name}<br><b>Jarak: ${length.toFixed(2)} km</b>`;
                        layer.bindTooltip(tooltipContent, { sticky: true }); // sticky agar tooltip mengikuti mouse
                    } else if (feature.geometry.type === 'Point') {
                        layer.bindTooltip(props.name, { sticky: true });
                    }
                }
            },

            // Fungsi untuk mengubah titik (Point) menjadi marker
            pointToLayer: function (feature, latlng) {
                const props = feature.properties;
                
                // REVISI: Marker START dan FINISH dibuat sama (default) agar menonjol
                if (props && props.name && (props.name.startsWith('START') || props.name.startsWith('FINISH'))) {
                    return L.marker(latlng); // Menggunakan marker default Leaflet (pin biru)
                }

                // Untuk titik lain yang memiliki properti 'marker-color'
                if (props && props['marker-color']) {
                    const markerColor = props['marker-color'];
                    // Membuat ikon kustom berbentuk lingkaran
                    const customIcon = L.divIcon({
                        className: 'custom-div-icon',
                        html: `<div style="background-color:${markerColor}; width:15px; height:15px; border-radius:50%; border:2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.5);"></div>`,
                        iconSize: [20, 20],
                        iconAnchor: [10, 10]
                    });
                    return L.marker(latlng, { icon: customIcon });
                }
                
                // Fallback jika ada titik lain tanpa properti
                return L.marker(latlng);
            }
        }).addTo(map);

        // 5. REVISI: Atur Tampilan Peta agar Sesuai (Fit Bounds)
        // Cari koordinat titik START dan FINISH
        let startCoords, finishCoords;
        geojsonData.features.forEach(feature => {
            if (feature.properties.name && feature.properties.name.startsWith('START')) {
                // GeoJSON format [longitude, latitude], Leaflet format [latitude, longitude]
                startCoords = [feature.geometry.coordinates[1], feature.geometry.coordinates[0]];
            }
            if (feature.properties.name && feature.properties.name.startsWith('FINISH')) {
                finishCoords = [feature.geometry.coordinates[1], feature.geometry.coordinates[0]];
            }
        });
        
        // Jika kedua titik ditemukan, atur view agar mencakup keduanya
        if (startCoords && finishCoords) {
            const bounds = L.latLngBounds([startCoords, finishCoords]);
            // .pad(0.15) memberikan ruang 15% di sekitar titik agar tidak terlalu mepet ke tepi layar
            map.fitBounds(bounds.pad(0.15)); 
        } else {
            // Fallback jika titik START/FINISH tidak ditemukan, gunakan view dari seluruh data
            map.fitBounds(geoJsonLayer.getBounds().pad(0.1));
        }

    </script>

</body>
</html>
